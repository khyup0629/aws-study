# DynamoDB

: `NoSQL 데이터베이스`를 제공하는 서비스입니다.   
사용자가 따로 설치, 운영, 확장하지 않아도 원할 때 바로 사용할 수 있도록 만든 서비스입니다.

읽기와 쓰기가 매우 빈번하고 처리 속도가 빨라야 하는 환경, 작은 용량의 데이터가 매우 많을 때, 고가용성의 분산 데이터베이스를 자체적으로 운영하기에는 부담될 때 적합합니다.   
따라서 `모바일 게임`과 `소셜 네트워크`와 같은 서비스에 유용합니다.   

관계형 데이터베이스가 아니기 때문에 복잡한 쿼리가 필요한 환경에는 적합하지 않습니다.

## NoSQL vs 관계형

> <h3>관계형 데이터베이스</h3>

![image](https://user-images.githubusercontent.com/43658658/146698193-9a0e4b84-5d4a-4c95-8623-5725f07cbc32.png)   
관계형 데이터베이스는 테이블에 데이터를 저장하기 전에, `테이블 구조`를 미리 만들어 놓아야 합니다.   
또한, `테이블간의 관계`를 주 키(Primary Key)와 외래 키(Foreign Key)를 이용하여 정의해야 합니다.   
이것을 데이터베이스 `스키마(Schema)`라고 합니다.   
그래서 관계형 데이터베이스는 미리 정해진 스키마에 맞게 데이터를 추가해야 하고, 스키마에 맞지 않으면 데이터를 추가할 수 없습니다.

> <h3>NoSQL 데이터베이스</h3>

![image](https://user-images.githubusercontent.com/43658658/146698258-59928340-415d-428e-bac1-d388ca06a412.png)   
NoSQL 데이터베이스는 기존의 관계형 데이터베이스와는 달리 `스키마`가 정해져 있지 않습니다.   
따라서 `비정형 데이터`를 저장하는데도 유용합니다. 정형화된 데이터를 저장해도 됩니다.

## NoSQL의 특징

> <h3>고가용성</h3>

리전별로 생성할 수 있으며 성능과 가용성을 위해 데이터를 3곳의 가용 영역에 복제하여 저장합니다.   
사용자가 따로 데이터를 백업할 필요가 없습니다.

> <h3>용량 제한 없음</h3>

저장할 수 있는 데이터 용량에 제한이 없습니다.   
데이터 용량이 증가하면 DynamoDB가 알아서 스토리지를 늘리고 클러스터를 확장하여 데이터를 분산시킵니다.

> <h3>자동 샤딩</h3>

기존 데이터베이스는 테이블의 용량이 커지면 `샤딩(Sharding)`이라는 방법을 통해 테이블의 데이터를 여러 서버에 분산해서 저장하였습니다.   
DynamoDB는 `샤딩`을 `자동으로 처리`해주기 때문에 데이터가 늘어나는 것에 대해 신경을 쓸 필요가 없습니다.

## DynamoDB 개념

> <h3>데이터 저장 구조</h3>

![image](https://user-images.githubusercontent.com/43658658/146698258-59928340-415d-428e-bac1-d388ca06a412.png)   
* `테이블(Table)` : 테이블은 아이템들의 모음입니다. 들어갈 수 있는 아이템의 개수는 제한이 없습니다. 그리고 테이블은 `기본 키(Primary Key)`를 반드시 지정해야 합니다. 리전당 생성할 수 있는 테이블의 최대 개수는 256개이며 AWS에 요청하여 더 늘릴 수 있습니다.
* `아이템(Item)` : 아이템은 `속성(Attribute)`들의 모음입니다. 들어갈 수 있는 속성의 개수는 제한이 없습니다. 단 아이템의 크기는 속성 이름과 값을 포함하여 64KB까지입니다. 기본 키는 필수로 포함하고 있어야 하며 복합키와 기타 속성을 가집니다.
* `속성(Attribute)` : 속성은 `키-값(Key-Value)` 방식입니다. 키는 문자열이라야 합니다.
  - 속성의 값에 NULL이나 빈 문자열은 저장할 수 없습니다. 

> <h3>데이터 형식</h3>

* 스칼라 데이터 형식(Scalar data types)
  - 숫자: `정수와 실수`를 지원합니다. 숫자는 0을 트림(Trim)합니다. 예) 0.3 → .3, 00300 → 300
  - 문자열: `UTF8` 형식이며 대소를 비교할 때에는 `아스키(ASCII)` 코드 기준으로 합니다.
  - 바이너리: 바이너리 데이터는 BASE64 형식으로 인코딩하여 저장하면 됩니다. 대소를 비교할 때에는 각 바이트를 부호 없는(unsigned) 정수로 취급합니다.
* 다중 값 형식(Multi-valued types): 스칼라 데이터 형식의 `배열 형태`입니다. 숫자 세트(Number Set), 문자열 세트(String Set), 바이너리 세트(Binary Set)가 있습니다. 
  - 다중 값 형식에 들어가는 값은 중복될 수 없으며 값이 하나라도 들어가 있어야 합니다. 
  - 값들은 정렬되지 않으며 정렬 순서도 저장되지 않습니다. 
  - 다중 값 형식은 기본 키로 사용할 수 없습니다.

> <h3>기본 키 형식</h3>

DynamoDB에서 검색을 하려면 기본 키로 인덱스를 생성해야 합니다. 그리고 이 기본 키는 테이블을 생성할 때 반드시 지정해야 하며 이 기본 키로 생성되는 인덱스를 `테이블 인덱스`라고 합니다.

* `해시(Hash)` 형식 기본 키: 속성 `한 개`를 기본 키로 사용합니다. 기본 키의 값은 스칼라 데이터 형식만 가능합니다. 다중 값 형식은 지원하지 않습니다.
  - `일치 방식` 검색만 지원합니다. 
* `해시와 범위(Range)` 형식 기본 키: 속성 `두 개`를 기본 키로 사용합니다. 첫 번째 속성은 해시 기본 키로 사용하고 두 번째 속성은 범위 기본 키로 사용하여 두 가지를 복합적으로 사용하는 방식입니다.
  - `일치, 부등호, 포함, ~로 시작` 등의 검색을 지원합니다.

기본 키로 생성하는 테이블 인덱스 이외에도 `보조 인덱스`를 생성할 수 있습니다. 기본 키로 생성한 인덱스 하나만으로는 검색 기능이 부족하기 때문에 사용자가 원하는 속성으로 보조 인덱스를 생성하여 `검색에 활용`할 수 있습니다. 이 보조 인덱스는 사용이 빈번하기 때문에 성능을 위해 `읽기/쓰기 용량 유닛을 따로 설정`할 수 있습니다.

* 로컬 보조 인덱스(Local Secondary Index) : 해시 키는 테이블 인덱스의 해시 기본 키와 같고, 범위 키는 다르게 설정한 것입니다. 테이블당 5개까지 생성할 수 있습니다.
* 글로벌 보조 인덱스(Global Secondary Index): 해시 키와 범위 키 모두 테이블 인덱스와 다르게 설정한 것입니다. 범위 키는 생략할 수 있습니다. 테이블당 5개까지 생성할 수 있습니다.

> <h3>데이터 읽기</h3>

* `Eventually Consistent Read(기본)` : 읽기 처리량(Read Throughput)을 최대화합니다. 쓰기가 데이터의 모든 복사본에 반영되는 것은 1초내에 이루어집니다. 최신 데이터를 얻으려면 짧은 시간 내에 읽기를 반복해야 합니다.
  - 읽은 데이터가 최근 완료된 쓰기 결과를 반영하지 못했을 수도 있습니다.  
* `Strongly Consistent Read` : 최근 완료된 쓰기 결과가 모두 반영된 데이터를 가져옵니다.



































