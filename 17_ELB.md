# ELB

서버의 부하 분산과 고가용성을 제공하는 서비스입니다.

하나의 ELB에 집중되는 HTTP, TCP, SSL 트래픽을 ELB와 연결된 여러 EC2 인스턴스로 분산합니다.   
그리고 서버가 정상적으로 가동 중인지 확인(Health Check)하여 일부 인스턴스가 중단되더라도 트래픽을 정상 인스턴스로만 보냅니다.

`리전별`로 생성해야 하고, 여러 `가용 영역`에서 실행되는 인스턴스로 부하를 분산시킬 수 있습니다.

## ELB 개념

* L4 : OSI 레이어에서 4번째 전송 계층을 뜻합니다. TCP, UDP 등의 프로토콜이 대표적이며 포트 번호로 구분합니다. 
  - 보통 OSI 레이어에서 3번째 네트워크 계층의 IP와 묶어서 처리합니다. 
  - `L4 로드밸런싱`이라고 하면 IP 주소와 포트 번호를 기준으로 트래픽을 분배합니다.
* L7 : OSI 레이어에서 7번째 애플리케이션 계층을 뜻합니다. HTTP 프로토콜이 대표적입니다. 
  - `L7 로드밸런싱`이라고 하면 HTTP 헤더의 내용을 기준으로 트래픽을 분배합니다.
* 헬스 체크(Health Check) : EC2 인스턴스가 정상적으로 가동 중인지 확인하는 기능입니다.
* 라운드 로빈(Round Robin) : ELB 알고리즘으로 우선 순위를 두지 않고 순서대로 분배하는 방식입니다.
* Connection Draining : `Auto Scaling`이 사용자의 요청을 처리 중인 EC2 인스턴스를 바로 삭제하지 못하도록 방지하는 기능입니다.
* Sticky Sessions : 사용자의 세션을 확인하여 적절한 EC2 인스턴스로 트래픽을 분배하는 기능입니다. L7 로드밸런싱의 기능입니다.
  - 예를 들어 동일한 사용자가 서비스에 계속 접속할 때 처음 접속했던 EC2 인스턴스에 연결시켜 줍니다. 
  - 이 기능을 사용하지 않으면 라운드 로빈 알고리즘에 따라 매번 다른 EC2 인스턴스에 연결됩니다.
* 지연 시간(Latency) : ELB와 EC2 인스턴스 간의 지연시간입니다.
* 서지 큐 길이(Surge Queue Length) : ELB 로드 밸런서에서 EC2 인스턴스로 전달되지 못하고 큐에 남아있는 요청의 개수입니다.
* Spillover Count : `서지 큐`가 꽉 차서 ELB 로드 밸런서가 거부한 요청의 개수입니다.

## ELB 생성

ELB를 이용하기 위해선 서로 다른 가용영역에 있는 EC2 인스턴스 2개 이상이 필요합니다.

[EC2 콘솔] > [로드밸런서] > [로드밸런서 생성]   

![image](https://user-images.githubusercontent.com/43658658/147070904-70285b20-2698-4268-abfc-d321b5fa559d.png)   
* ALB : Nginx, Apache와 같은 HTTP/HTTPS(L7 계층)의 부하분산을 지원합니다.
* NLB : L4 계층의 부하분산을 지원합니다.
* GLB : L3 계층의 부하분산을 지원합니다. 모든 포트에서 모든 IP 패킷을 수신하고 리스너 규칙에 지정된 대상 그룹에 트래픽을 전달합니다.



















